{% load static %}
<!-- Signin or Login Page -->

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    {% include 'main_app/common_meta.html' %}

    <!-- Link or CSS Tags -->
    {% include 'main_app/common_css.html' %}
    <link rel="stylesheet" href="{% static 'accounts/css/signup_style.css' %}">

    <title>Neerog - Hospital Registeration</title>

</head>
<body>

    <!-- Messages -->
    {% include 'main_app/show_messages.html' %}

    <!-- Navbar -->
    {% include 'main_app/navbar.html' %}

    <form method="post" class="login-form" action="{% url 'register_hospital' %}">
    {% csrf_token %}
    <h1>Register - Hospital</h1>

    <div class="textb" style="width: 48%; float: left; height: 60px; ">
        <select name="country" class="country" required style="height: 60px;">
            <option value="">Select Country</option>
            <option value="India">India</option>
            <option value="Other">Other</option>
        </select>
    </div>

    <div class="textb" style="width: 48%; float: right; height: 60px; ">
        <select name="city" class="city" required style="height: 60px;">
            <option value="">Select City</option>
            <option value="Delhi">Delhi</option>
            <option value="Other">Mumbai</option>
            <option value="Other">Kolkata</option>
            <option value="Other">Chennai</option>
        </select>
    </div>

    <div class="textb area" style="clear: left;">
        <input type="text" name="area" required>
        <div class="placeholder">Area, Road or Street</div>
    </div>

    <div class="textb phone">
        <input type="text" name="phone" required>
        <div class="placeholder">Phone or Mobile</div>
    </div>

    <div class="specialization">
        <div class="textb">
        <label for="specialization" class="file_label">Select Hospital Specializations</label>
        </div>
        {% for sp in specialities%}         
        <div class="checkbox" style="width: 45%; float: left; padding-left: 10px; height: 20px; clear: left;">
            <input type="checkbox" name="specialization" value="{{sp}}">
            <div class="fas fa-check"></div>
            {{sp}}
        </div>
        <div class="textb price" style="width: 53%; float: right; height: 20px; ">
            <input type="text" name="{{sp}}" id="{{sp}}" disabled>
            <div class="placeholder">Pricing In Rupees</div>
        </div>
        {% endfor %}
    </div>
    <div style="padding-top: 20px; clear: left;"></div>
    
    <div class="textb">
        <label for="pic1" class="file_label">Hospital Image</label>
        <input type="file" class="file_input" name="pic1" required>
    </div>

    <div class="textb">
        <label for="proof" class="file_label">License or Certification Of Hospital</label>
        <input type="file" class="file_input" name="proof" required>
    </div>
    
    <div class="textb form_feedback"></div>

    <button class="btn" disabled>Submit</button>
    </form>

    <script>

    function validateNumber(mynumber) 
    {
        if (/^\d+$/.test(mynumber))
        {
            return (true)
        }
        return (false)
    }

    function validatePhone(myphone)
    {
        if(myphone.length == 10 && validateNumber(myphone) == true)
        {
            return (true)
        }
        return (false)
    }

    function validateFile(filePath)
    {
        let allowedExtensions =  /(\.doc|\.docx|\.odt|\.pdf|\.jpeg|\.jpg|\.rtf|\.png)$/i;     
        if (!allowedExtensions.exec(filePath)) 
        { 
            filePath = '';
            return false;
        }
        else
        {
            return true;
        }
    }

    function validateImage(filePath)
    {
        let allowedExtensions =  /(\.jpeg|\.jpg|\.gif\.png)$/i;     
        if (!allowedExtensions.exec(filePath)) 
        { 
            filePath = '';
            return false;
        }
        else
        {
            return true;
        }
    }

    var btn = document.querySelector(".btn");

    var area=document.querySelectorAll(".area input")[0];
    area.addEventListener("keyup",check);

    var phone=document.querySelectorAll(".phone input")[0];
    phone.addEventListener("keyup",check);

    var specialization=document.querySelectorAll(".specialization input[type='checkbox']");
    for(sp of specialization)
    {
        sp.addEventListener("click",enableInput);
        sp.addEventListener("click",check);
    }

    var country=document.querySelector(".country");
    country.addEventListener("click",check);

    var city=document.querySelector(".city");
    city.addEventListener("click",check);

    var hospital_pic =  document.querySelectorAll('.file_input')[0];
    hospital_pic.addEventListener("change",check);

    var certificate =  document.querySelectorAll('.file_input')[1];
    certificate.addEventListener("change",check);

    var feedback = document.querySelector(".form_feedback")
    function check()
    {
        let checked = document.querySelectorAll(".specialization input[type='checkbox']:checked");
        if(country.value != "")
        {
            if(city.value != "")
            {
                if(area.value != "")
                {
                    if(validatePhone(phone.value) == true)
                    {
                        if(checked.length > 0)
                        {
                            let priceverified = true;
                            for(ch of checked)
                            {
                                let pricebox=document.getElementById(ch.value);
                                if(!validateNumber(pricebox.value))
                                {
                                    priceverified = false;
                                }
                            }
                            if(priceverified)
                            {
                                if(validateImage(hospital_pic.value))
                                {
                                    if(validateFile(certificate.value))
                                    {
                                        feedback.innerHTML = "";
                                        btn.disabled = false;
                                    }
                                    else
                                    {
                                        feedback.innerHTML = "*Please Submit A Valid License of the Hospital.";
                                        btn.disabled = true;
                                    }
                                }
                                else
                                {
                                    feedback.innerHTML = "*Please Submit an Image of the Hospital.";
                                    btn.disabled = true;
                                }
                            }
                            else
                            {
                                feedback.innerHTML = "*Please Enter Numeric Price for All Selected Specialities.";
                                btn.disabled = true;
                            }    
                        }
                        else
                        {
                            feedback.innerHTML = "*Please Select Atleast One Medical Speciality.";
                            btn.disabled = true;
                        }
                    }
                    else
                    {
                        feedback.innerHTML = "*Please Enter a Valid Phone Number.";
                        btn.disabled = true;
                    }
                }
                else
                {
                    feedback.innerHTML = "*Please Enter the Area or Locality of the Hospital.";
                    btn.disabled = true;
                }
            }
            else
            {
                feedback.innerHTML = "*Please Select A City.";
                btn.disabled = true;
            }
        }
        else
        {
            feedback.innerHTML = "*Please Select A Country.";
            btn.disabled = true;
        } 
    }


    function enableInput()
    {
        let checked = document.querySelectorAll(".specialization input[type='checkbox']:checked");
        for(ch of checked)
        {
            let pricebox=document.getElementById(ch.value);
            pricebox.disabled = false;
            pricebox.addEventListener("keyup",check);
        }
    }
    </script>

    <!-- JavaScript -->
    {% include 'main_app/common_js.html' %}
</body>
</html> 