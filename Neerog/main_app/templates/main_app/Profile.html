<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <title>Profile</title>
     <meta name="viewport" content="width=device-width, initial-scale=1">
    {% include "main_app/header.html" %}
    {% include 'main_app/chart.html' %}
    <!-- Meta Tags -->
    <!-- Link or CSS Tags -->
    {% include 'main_app/common_css.html' %}
    {% include 'main_app/common_js.html' %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script>
        $(document).ready(function()
        {
           var dt=new Date();
           var month=dt.getMonth()+1;
           var day=dt.getDate();
           var year=dt.getFullYear();
           if(month < 10)
               month='0'+month.toString();
           if(day < 10)
               day='0'+day.toString();
            var hours=dt.getHours();
            var minutes=dt.getMinutes();
            if(hours<10)
                 hours='0'+hours.toString();
            if(minutes<10)
                 minutes='0'+minutes.toString()
           var maxDate=year+'-'+month+'-'+day+'T'+hours+':'+minutes;
           $("#start").attr('min',maxDate);
           $("#end").attr('min',maxDate);
        });
    </script>
    <script>
        function validate()
        {
        var start=document.getElementById("start").value;
        var end=document.getElementById("end").value;
        var d=new Date();
        var d2=new Date(start);
        var d1=new Date(end);
        if(!Date.parse(start) || !Date.parse(end)){
         alert('Please Select Appropriate Date');
            return false;
        }
        if(!(d1>=d2)){
             alert('Please Select Appropriate Date');
            return false;
        }
        }
    </script>
    <script>
    $(document).ready(function(){
         var p=$("#filter_type").val();
         var str1="."+p
         $(str1).attr("selected","selected");
         if(p=="Date"){
            $("#search_value").empty();
            $("#search_value").append(`<input type="date" id="Date" value="{{ search_value }}" class="form-control" required name="search_values">
                                  </input>`);}
            else{
             $("#search_value").empty();
            $("#search_value").append(`<input type="text" value="{{ search_value }}" class="form-control" required name="search_values">
                                  </input>`);}



       $("#filters").on("change",function(){
        var filter=$("#filters").val();
        if(filter=="Select")
             alert("Select Appropriate Filter");
        else
        {
            if(filter=="Date"){
            $("#search_value").empty();
            $("#search_value").append(`<input type="date" id="Date"  class="form-control" required name="search_values">
                                  </input>`);}
            else{
             $("#search_value").empty();
            $("#search_value").append(`<input type="text"  class="form-control" required name="search_values">
                                  </input>`);}
                                  }
                                  });
                                  });
    </script>
    <script>
        $(document).ready(function()
        {
        $('#form1').on('submit',function(){
             document.getElementById("loader").style.display = "block";
             document.getElementById("myDiv").style.display = "none";
});
       })
    </script>
    <style>
    @media only screen and (max-width: 400px) {
        *
        {
         font-size:10px;
        }
     .col-12 button
     {
       margin-top:10px !important;
     }
     .card
    {
    margin-left:20px!important;
    border-radius:20px!important;
    margin-top:10px!important;
    }
    .cha
    {
       width:300px!important;
       margin-left:20px!important;
       border-radius:20px!important;
    }
    .da
    {
    width:300px!important;
       margin-left:20px!important;
       border-radius:20px!important;
       height:100px!important;
    }
    }
    #search
        {
          float:right;
        }
    .card
    {
    margin-left:10px!important;
    border-radius:20px!important;
    margin-top:10px!important;

    }
    .da
    {
       width:400px;
       margin-left:20px;
       border-radius:20px;
       height:300px;
    }
    .cha
    {
       width:400px;
       margin-left:20px;
       border-radius:20px;
    }
    th
    {
     font-size:12px;
     color:white;
     }
    .table-striped th
    {
     font-size:15px;
     color:black;
     }
     .sticky th
     {
     background-color:#404040;
     position:sticky;
     top:0;
     }
    .card-header
    {
    background-color:#404040;
    color:white;
    border-radius:20px!important;
    text-align:center!important;
    }
    h1
    {
     color:blue;
     text-align:center;
     }
    </style>
    <style>
    body::before
{
    background: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url("{% static 'image9.jpeg' %}") no-repeat center;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    content:"";
    position: absolute;
    top:0;
    left:0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.7;
}
/* Center the loader */
#loader {
  position: absolute;
	left: 0px;
	top: 0px;
	width: 100%;
	height: 100%;
	z-index: 9999;
	background: url(https://smallenvelop.com/wp-content/uploads/2014/08/Preloader_11.gif) center no-repeat #fff;
}
</style>
    <script>
        document.onreadystatechange = function() {
    if (document.readyState !== "complete") {
        document.querySelector("body").style.visibility = "hidden";
        document.querySelector("#loader").style.visibility = "visible";
    } else {
        document.querySelector("#loader").style.display = "none";
        document.querySelector("body").style.visibility = "visible";
    }
};
    </script>
</head>
{% include 'main_app/navbar.html' %}
<!--{% include 'main_app/navbar.html' %}-->
{% include 'main_app/show_messages.html' %}
<body  style="overflow-x:hidden;" class="container-fluid">
<div id="loader"></div>

 <div style="margin-top:100px;" id="myDiv">
     <div>
{% if User_Details.doctorid %}
<div class="row">
    <div class="col-lg-4 col-md-3 col-sm-3">
        <div class="card cha">
        <div class="card-header">
            Registered Appointments This Month
        </div>
        <div class="card-body">
            <h1 >{{ no_of_Appointments }}</h1>
        </div>
    </div>
    </div>
    <div class="col-lg-4 col-md-3 col-sm-3">
        <div class="card cha">
        <div class="card-header">
    Completed Appointments This Month
  </div>
        <div class="card-body ">
            <h1>{{ no_of_Appointments_completed }}</h1>
        </div>
    </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-3">
        <div class="card cha">
        <div class="card-header">
    Online Consultations This Month
  </div>
        <div class="card-body">
            <h1>{{ online_Appointments }}</h1>
        </div>
    </div>
    </div>
</div>
{% elif  User_Details.tlabid %}
<div class="row">
    <div class="col-lg-4 col-md-3 col-sm-3">
        <div class="card da">
        <div class="card-header">
            Registered Appointments This Month
        </div>
        <div class="card-body">
            <h1 >{{ no_of_Appointments }}</h1>
        </div>
    </div>
    </div>
    <div class="col-lg-4 col-md-3 col-sm-3">
        <div class="card da">
        <div class="card-header">
    Completed Appointments This Month
  </div>
        <div class="card-body">
            <h1>{{ no_of_Appointments_completed }}</h1>
        </div>
    </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-3">
        <div class="card">
        <div class="card-body">

            <canvas id="myChart" width="400" height="400"></canvas>
<script>
var ctx = document.getElementById('myChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels:{{ Test_Names|safe }},
        datasets: [{
            label: 'No Of Tests This Month',
            data: {{ dict_test }},
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>
        </div>
    </div>
    </div>
</div>
{% endif %}
<div id="appointment" style="margin-top:20px;">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
            <div class="card-header">List Of Appointments</div>
             {% if User_Details.patientid %}
                {% else %}
                {% if User_Details.doctorid %}
             <form action="{% url 'edit_time' id=User_Details.doctorid %}" id="form3" method="post"><!-- onsubmit="return validate()"-->
                {% else %}
             <form action="{% url 'edit_time' id=User_Details.tlabid %}"  method="post"><!-- onsubmit="return validate()"-->
                {% endif %}
                 {% csrf_token %}
                 <div class="row">
             <div class="col-lg-2 offset-lg-4" style="margin-top:30px;"><b>Edit Available Time:</b></div>
                <div class="col-lg-2">
                         <label for="start_time"><b>Start Time:</b></label>
                        <input type="time" class="form-control" required value="{{ User_Details.start_time }}" name="start_time" id="start_time"></div>
                    <div class="col-lg-2">
                        <label for="end_time"><b>End Time:</b></label>
                       <input type="time"  class="form-control" required value="{{ User_Details.end_time }}" name="end_time" id="end_time">
                    </div>
                 <div class="col-lg-2">
                    <button type="submit" class="btn btn-success form-control" style="margin-top:30px;">Edit</button>
                </div>
                 </div>
             </form>
                {% endif %}
            <form action="{% url 'availablity' %}" id="form1" method="post" onsubmit="return validate()">
                {% csrf_token %}
            <div style="margin-top:10px;" class="row">
                {% if User_Details.patientid %}
                {% else %}
                <div class="col-lg-3 offset-lg-4  Non_Available_date form-group" style="display:block;">
                    <b>Unavailable From:</b><input type="datetime-local" class="form-control"  id="start" name="start">
                </div>
                <div class="col-lg-3 Non_Available_date" style="display:block;">
                    <b> To:</b><input type="datetime-local" class="form-control" id="end" name="end">
                </div>
                <div class="col-lg-2 Non_Available_date" style="display:block;margin-top:25px;">
                    <button type="submit" class="btn btn-primary form-control">Submit</button>
                </div>

                {% endif %}
                </div>
                </form>
           <div  style="margin-top:20px;">
            <form action="{% url 'search_appointments' %}" method="get">
                {% csrf_token %}
                <div class="row">
                    <div class="col-lg-2 col-sm-1 col-6 offset-lg-4">
                        <label for="filters" style="float:right;"><b>Filter By:</b></label></div>
                       <input type="text" hidden value="{{ filter_type }}" id="filter_type">
                    <div class="col-lg-2 col-sm-2 col-6 form-group">

                <select id="filters" name="filter" class="form-control" style="float:right;" required>
                    <option value="Date" class="Date" selected>Date</option>
                    {% if User_Details.patientid %}
                    <option value="Doctor_Name" class="Doctor_Name">Doctor Name</option>
                    {% else %}
                   <option value="Patient_Name" class="Patient_Name">Patient Name</option>
                    {% endif %}

                </select>
                </div>

                <div class="col-lg-2 col-sm-2 col-12" id="search_value">
                <input type="date" id="Date" class="form-control" value="{{ search_value }}" required name="search_values">
                                  </div>

                <div class="col-lg-2 col-sm-2 col-12">
                    <button type="submit"  class="form-control btn btn-success">Apply</button>

                </div>
                </div>
                 </form>
        </div>
                <div class="card-body">
                <div class="table-responsive">
        <table class="table sticky" style="margin-top:30px;">
            {% if list_of_Appointments %}
            <thead style="background-color:#404040;">
              <tr>
                <th>Appointment Id</th>
                <th>Patient Name</th>
                 {% if User_Details.doctorid %}
                <th>Patient Email Id</th>
                  {% else %}
                  {% if User_Details.tlabid %}
                  <th>Patient Email Id</th>
                  <th>Test Name</th>
                  {% else %}
                <th>Doctor Email Id</th>
                  {% endif %}
                  {% endif %}
                {% if User_Details.patientid %}
                <th>Speciality/Tests</th>
                  {% endif %}
                <th>Appointment Date</th>
                <th>Appointment Time</th>
                <th>Mode Of Meeting</th>
                  {% if User_Details.tlabid %}
                  {% else %}
                <th>Meeting url</th>
                  {% endif %}
                  {% if User_Details.tlabid %}
                  <th>Test Report</th>
                  {% else %}
                  <th>Prescription</th>
                  {% endif %}
              </tr>
           <tbody>
        {% for i,j in list_of_Appointments.items %}
          <tr>
              <td><a href='{% url "Appointment_Details" appointment_id=i.appointmentid %}'>{{ i.appointmentid }}</a></td>
            <td>{{ i.patientname }}</td>
            {% if User_Details.doctorid %}
            <td>{{ i.patientemail }}</td>
              {% else %}
              {% if User_Details.tlabid %}
              <td>{{ i.patientemail }}</td>
              <td>{{ i.Speciality }}</td>
              {% else %}
              <td>{{ i.doctoremail }}</td>
              {% endif %}
              {% endif %}
              {% if User_Details.patientid %}
              <td>{{ i.Speciality }}</td>
              {% endif %}
              <td>{{ i.appointment_date }}</td>
              <td>{{ i.appointment_time }}</td>
            <td>{{ i.mode_of_meeting }}</td>
              {% if User_Details.tlabid %}
              {% else %}
              {% ifequal i.meeting_url None %}
              <td>{{ i.meeting_url }}</td>
              {% else %}
              <td><a href="{{ i.meeting_url }}">{{ i.meeting_url }}</a></td>
              {% endifequal %}
              {% endif %}
            <td>
                {% if User_Details.doctorid %}
                {% ifequal j "Upload Prescription" %}
                <form action="{% url 'prescription' %}" method="post">
                    {% csrf_token %}
                    <input type="text" name="id" hidden value="{{ i.appointmentid }}">
                    <input type="email" name="Email" hidden value="{{ i.patientemail }}">
                     <button type="submit" class="btn btn-success"> Upload Prescription</button>
                   </form>
                {% else %}
                <button class="btn btn-success"><a href='{{ j.Prescription.url }}' style="color:white;" download> Download Prescription</a></button>
               {% endifequal %}
                {% elif User_Details.tlabid %}
                {% ifequal j "Upload Prescription" %}
                <form action="{% url 'prescription' %}" method="post">
                    {% csrf_token %}
                    <input type="text" name="id" hidden value="{{ i.appointmentid }}">
                    <input type="email" name="Email" hidden value="{{ i.patientemail }}">
                     <button type="submit" class="btn btn-success"> Upload Report</button>
                   </form>
                {% else %}
                <button class="btn btn-success"><a href='{{ j.Prescription.url }}' style="color:white;" download> Download Report</a></button>
               {% endifequal %}
                {% else %}
                {% ifequal j "Upload Prescription" %}
                <button  class="btn btn-success"> No Prescription Uploaded</button>
                {% else %}
                <button class="btn btn-success"><a href='{{ j.Prescription.url }}' style="color:white;" download> Download Prescription</a></button>
               {% endifequal %}
                {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
            {% else %}
            <center>No Appointments Availaible</center>
            {% endif %}
  </table>
    </div>
</div>
        </div>
    </div>
        </div>
</div>
     </div>
 </div>
</body>
</html>